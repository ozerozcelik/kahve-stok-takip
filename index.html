<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚òï Kahve Stok Takip</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const CoffeeInventory = () => {
            const defaultCategories = [
                { id: 1, name: 'Kahve & √áekirdek', icon: '‚òï' },
                { id: 2, name: 'S√ºt & Krema', icon: 'ü•õ' },
                { id: 3, name: '≈ûeker & Tatlandƒ±rƒ±cƒ±', icon: 'üç¨' },
                { id: 4, name: 'Bardak & Kapak', icon: 'ü•§' },
                { id: 5, name: 'Sos & ≈ûurup', icon: 'üçØ' },
                { id: 6, name: 'Diƒüer Malzemeler', icon: 'üì¶' },
            ];

            const defaultProducts = [
                { id: 1, categoryId: 1, name: 'Espresso √áekirdeƒüi', unit: 'kg', current: 5, orderQty: 0, minStock: 3, supplier: 'Kahve D√ºnyasƒ±', orderStatus: '' },
                { id: 2, categoryId: 1, name: 'Filter Kahve √áekirdeƒüi', unit: 'kg', current: 3, orderQty: 0, minStock: 2, supplier: 'Kahve D√ºnyasƒ±', orderStatus: '' },
                { id: 3, categoryId: 2, name: 'Tam Yaƒülƒ± S√ºt', unit: 'litre', current: 15, orderQty: 0, minStock: 10, supplier: 'Pƒ±nar', orderStatus: '' },
            ];

            const [categories, setCategories] = useState(defaultCategories);
            const [products, setProducts] = useState(defaultProducts);
            const [suppliers, setSuppliers] = useState(['Kahve D√ºnyasƒ±', 'Pƒ±nar', 'Metro']);
            const [orderHistory, setOrderHistory] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [showMenu, setShowMenu] = useState(false);
            const [showAddProduct, setShowAddProduct] = useState(false);
            const [showStats, setShowStats] = useState(false);
            const [userName, setUserName] = useState('');
            const [showNamePrompt, setShowNamePrompt] = useState(true);
            const [isLoading, setIsLoading] = useState(true);
            const [darkMode, setDarkMode] = useState(false);
            const [sortBy, setSortBy] = useState('name');

            useEffect(() => {
                setTimeout(() => setIsLoading(false), 500);
            }, []);

            const updateProduct = (id, field, value) => {
                setProducts(prev => prev.map(p => {
                    if (p.id === id) {
                        const updated = { ...p, [field]: value };
                        if (field === 'orderQty' && parseFloat(value) > 0 && p.orderStatus === 'ordered') {
                            updated.orderStatus = '';
                        }
                        return updated;
                    }
                    return p;
                }));
            };

            const quickUpdateStock = (id, amount) => {
                setProducts(prev => prev.map(p => 
                    p.id === id ? { ...p, current: Math.max(0, (parseFloat(p.current) || 0) + amount) } : p
                ));
            };

            const getCategoryStats = () => {
                return categories.map(cat => {
                    const categoryProducts = products.filter(p => p.categoryId === cat.id);
                    const lowStockCount = categoryProducts.filter(p => p.current <= p.minStock).length;
                    const totalStock = categoryProducts.reduce((sum, p) => sum + (parseFloat(p.current) || 0), 0);
                    return {
                        ...cat,
                        productCount: categoryProducts.length,
                        lowStockCount,
                        totalStock: totalStock.toFixed(1)
                    };
                });
            };

            const exportOrderList = () => {
                const orderItems = products.filter(p => p.orderQty > 0);
                if (orderItems.length === 0) {
                    alert('Sipari≈ü listesi bo≈ü');
                    return;
                }
                
                const excelData = [
                    ['Sƒ∞PARƒ∞≈û Lƒ∞STESƒ∞'],
                    ['Tarih:', new Date().toLocaleDateString('tr-TR')],
                    ['Sipari≈ü Veren:', userName],
                    [],
                    ['√úr√ºn', 'Birim', 'Mevcut Stok', 'Sipari≈ü Miktarƒ±'],
                    ...orderItems.map(p => [p.name, p.unit, p.current, p.orderQty]),
                ];

                const ws = XLSX.utils.aoa_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Sipari≈ü');
                XLSX.writeFile(wb, `Siparis_${new Date().toLocaleDateString('tr-TR').replace(/\./g, '-')}.xlsx`);
                
                setProducts(prev => prev.map(p => p.orderQty > 0 ? { ...p, orderStatus: 'ordered' } : p));
            };

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-6xl mb-6">‚òï</div>
                            <p className="text-white text-xl font-semibold">Y√ºkleniyor...</p>
                        </div>
                    </div>
                );
            }

            if (showNamePrompt && !userName) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full">
                            <div className="text-center mb-6">
                                <div className="text-6xl mb-4">‚òï</div>
                                <h1 className="text-2xl font-bold text-amber-900">Stok Y√∂netimi</h1>
                                <p className="text-gray-600 mt-2">Ho≈ü geldiniz!</p>
                            </div>
                            <input
                                type="text"
                                placeholder="ƒ∞sminizi girin"
                                className="w-full px-4 py-3 border-2 border-amber-200 rounded-lg text-lg focus:border-amber-500 focus:outline-none"
                                onKeyPress={(e) => {
                                    if (e.key === 'Enter' && e.target.value.trim()) {
                                        setUserName(e.target.value.trim());
                                        setShowNamePrompt(false);
                                    }
                                }}
                                autoFocus
                            />
                            <button
                                onClick={(e) => {
                                    const input = e.target.previousSibling;
                                    if (input.value.trim()) {
                                        setUserName(input.value.trim());
                                        setShowNamePrompt(false);
                                    }
                                }}
                                className="w-full mt-4 bg-amber-600 text-white py-3 rounded-lg font-semibold text-lg"
                            >
                                Ba≈üla
                            </button>
                        </div>
                    </div>
                );
            }

            const filteredProducts = products.filter(p => {
                const matchesCategory = selectedCategory ? p.categoryId === selectedCategory : true;
                const matchesSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesCategory && matchesSearch;
            });

            const sortedProducts = [...filteredProducts].sort((a, b) => {
                if (sortBy === 'name') return a.name.localeCompare(b.name, 'tr');
                if (sortBy === 'nameDesc') return b.name.localeCompare(a.name, 'tr');
                if (sortBy === 'stock') return a.current - b.current;
                if (sortBy === 'stockDesc') return b.current - a.current;
                if (sortBy === 'lowStock') {
                    const aLow = a.current <= a.minStock ? 1 : 0;
                    const bLow = b.current <= b.minStock ? 1 : 0;
                    return bLow - aLow;
                }
                return 0;
            });

            const lowStockProducts = products.filter(p => p.current <= p.minStock);
            const categoryStats = getCategoryStats();
            const totalOrderItems = products.filter(p => p.orderQty > 0).length;

            return (
                <div className={`min-h-screen pb-24 ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}`}>
                    <div className={`${darkMode ? 'bg-gray-800' : 'bg-gradient-to-r from-amber-600 to-orange-600'} text-white p-4 shadow-lg sticky top-0 z-40`}>
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-xl font-bold">‚òï Stok Y√∂netimi</h1>
                                <p className="text-sm opacity-80">{userName}</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2 hover:bg-white/20 rounded-lg">
                                    {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                                </button>
                                <button onClick={() => setShowStats(true)} className="p-2 hover:bg-white/20 rounded-lg">
                                    üìä
                                </button>
                                <button onClick={() => setShowMenu(!showMenu)} className="p-2 hover:bg-white/20 rounded-lg">
                                    ‚ò∞
                                </button>
                            </div>
                        </div>
                    </div>

                    {lowStockProducts.length > 0 && (
                        <div className="bg-red-500 text-white p-4">
                            <p className="font-bold">‚ö†Ô∏è {lowStockProducts.length} √ºr√ºn d√º≈ü√ºk stokta!</p>
                        </div>
                    )}

                    {showStats && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className={`${darkMode ? 'bg-gray-800 text-white' : 'bg-white'} rounded-2xl p-6 max-w-2xl w-full max-h-96 overflow-y-auto`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold">üìä ƒ∞statistikler</h3>
                                    <button onClick={() => setShowStats(false)} className="text-2xl">√ó</button>
                                </div>
                                
                                <div className="space-y-4">
                                    {categoryStats.map(stat => (
                                        <div key={stat.id} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} rounded-lg p-4`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <h4 className="font-bold">{stat.icon} {stat.name}</h4>
                                                {stat.lowStockCount > 0 && (
                                                    <span className="bg-red-100 text-red-700 text-xs px-2 py-1 rounded-full">
                                                        {stat.lowStockCount} D√º≈ü√ºk
                                                    </span>
                                                )}
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <p className="text-xs opacity-60">√úr√ºn Sayƒ±sƒ±</p>
                                                    <p className="text-2xl font-bold">{stat.productCount}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs opacity-60">Toplam Stok</p>
                                                    <p className="text-2xl font-bold">{stat.totalStock}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="p-4">
                        <input
                            type="text"
                            placeholder="√úr√ºn ara..."
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                            className={`w-full px-4 py-3 border-2 rounded-lg ${darkMode ? 'bg-gray-800 border-gray-700 text-white' : 'border-gray-300'}`}
                        />

                        <div className="flex gap-2 mt-4 overflow-x-auto pb-2">
                            <button onClick={() => setSortBy('name')} className={`px-3 py-2 rounded-lg text-sm font-semibold whitespace-nowrap ${sortBy === 'name' ? 'bg-amber-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-white')}`}>A-Z</button>
                            <button onClick={() => setSortBy('nameDesc')} className={`px-3 py-2 rounded-lg text-sm font-semibold whitespace-nowrap ${sortBy === 'nameDesc' ? 'bg-amber-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-white')}`}>Z-A</button>
                            <button onClick={() => setSortBy('stock')} className={`px-3 py-2 rounded-lg text-sm font-semibold whitespace-nowrap ${sortBy === 'stock' ? 'bg-amber-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-white')}`}>Stok‚Üë</button>
                            <button onClick={() => setSortBy('stockDesc')} className={`px-3 py-2 rounded-lg text-sm font-semibold whitespace-nowrap ${sortBy === 'stockDesc' ? 'bg-amber-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-white')}`}>Stok‚Üì</button>
                            <button onClick={() => setSortBy('lowStock')} className={`px-3 py-2 rounded-lg text-sm font-semibold whitespace-nowrap ${sortBy === 'lowStock' ? 'bg-red-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-white')}`}>D√º≈ü√ºk √ñnce</button>
                        </div>
                    </div>

                    <div className="px-4 space-y-3">
                        {sortedProducts.map(product => {
                            const isLowStock = product.current <= product.minStock;
                            const isOrdered = product.orderStatus === 'ordered';
                            
                            return (
                                <div key={product.id} className={`rounded-xl shadow-md p-4 ${darkMode ? 'bg-gray-800' : 'bg-white'} ${isLowStock ? 'border-l-4 border-red-500' : ''}`}>
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h3 className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                {product.name}
                                                {isLowStock && <span className="ml-2 bg-red-100 text-red-700 text-xs px-2 py-1 rounded-full">D√ú≈û√úK</span>}
                                                {isOrdered && <span className="ml-2 bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-full">‚úì Sipari≈ü Verildi</span>}
                                            </h3>
                                            <p className={`text-xs mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                Min. Stok: {product.minStock} {product.unit}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex gap-2 mb-3">
                                        <button onClick={() => quickUpdateStock(product.id, -5)} className={`flex-1 py-2 rounded-lg text-sm font-semibold ${darkMode ? 'bg-gray-700 text-white' : 'bg-gray-200'}`}>-5</button>
                                        <button onClick={() => quickUpdateStock(product.id, -1)} className={`flex-1 py-2 rounded-lg text-sm font-semibold ${darkMode ? 'bg-gray-700 text-white' : 'bg-gray-200'}`}>-1</button>
                                        <button onClick={() => quickUpdateStock(product.id, 1)} className={`flex-1 py-2 rounded-lg text-sm font-semibold ${darkMode ? 'bg-green-700 text-white' : 'bg-green-100 text-green-700'}`}>+1</button>
                                        <button onClick={() => quickUpdateStock(product.id, 5)} className={`flex-1 py-2 rounded-lg text-sm font-semibold ${darkMode ? 'bg-green-700 text-white' : 'bg-green-100 text-green-700'}`}>+5</button>
                                        <button onClick={() => quickUpdateStock(product.id, 10)} className={`flex-1 py-2 rounded-lg text-sm font-semibold ${darkMode ? 'bg-green-700 text-white' : 'bg-green-100 text-green-700'}`}>+10</button>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className={`text-xs mb-1 block font-semibold ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Mevcut Stok</label>
                                            <div className="flex items-center gap-2">
                                                <input
                                                    type="number"
                                                    value={product.current}
                                                    onChange={(e) => updateProduct(product.id, 'current', parseFloat(e.target.value) || 0)}
                                                    className={`w-full px-3 py-2 border-2 rounded-lg font-bold text-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                                                    step="0.1"
                                                />
                                                <span className={`text-sm font-semibold ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{product.unit}</span>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="text-xs mb-1 block font-semibold text-orange-600">Sipari≈ü Ver</label>
                                            <div className="flex items-center gap-2">
                                                <input
                                                    type="number"
                                                    value={product.orderQty}
                                                    onChange={(e) => updateProduct(product.id, 'orderQty', parseFloat(e.target.value) || 0)}
                                                    className={`w-full px-3 py-2 border-2 rounded-lg font-bold text-lg ${darkMode ? 'bg-orange-900/20 border-orange-700 text-white' : 'bg-orange-50 border-orange-300'}`}
                                                    step="0.1"
                                                />
                                                <span className={`text-sm font-semibold ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{product.unit}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {totalOrderItems > 0 && (
                        <div className="fixed bottom-6 right-6 z-50">
                            <button
                                onClick={exportOrderList}
                                className="bg-green-600 text-white p-4 rounded-full shadow-2xl flex items-center gap-2"
                            >
                                üõí
                                <span className="bg-white text-green-600 px-2 py-1 rounded-full text-sm font-bold">{totalOrderItems}</span>
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<CoffeeInventory />, document.getElementById('root'));
    </script>
</body>
</html>
